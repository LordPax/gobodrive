<?php
	/*===============================================================*\
	
	fonction de chiffrement vigenere : 
	createur : Teddy GAUTHIER
	
	maj 1.2 :
	modification
		~ correction de bug
	
	maj 1.1 :
	modification
		~ correction de bug
	
	maj 1.0 :
	ajout
		+ cette fonction
	
	\*===============================================================*/


	function cryptage($msgClair, $cle){
		$n0 = 0; $n1 = 1; $n2 = 2; $n3 = 3; $n4 = 4; $n5 = 5; $n6 = 6; $n7 = 7; $n8 = 8; $n9 = 9; $n10 = 10; $n11 = 11; $n12 = 12; $n13 = 13; $n14 = 14; $n15 = 15; $n16 = 16; $n17 = 17; $n18 = 18; $n19 = 19; $n20 = 20; $n21 = 21; $n22 = 22; $n23 = 23; $n24 = 24; $n25 = 25; $n26 = 26; $n27 = 27; $n28 = 28; $n29 = 29; $n30 = 30; $n31 = 31; $n32 = 32; $n33 = 33; $n34 = 34; $n35 = 35; $n36 = 36; $n37 = 37; $n38 = 38; $n39 = 39; $n40 = 40; $n41 = 41; $n42 = 42; $n43 = 43; $n44 = 44; $n45 = 45; $n46 = 46; $n47 = 47; $n48 = 48; $n49 = 49; $n50 = 50; $n51 = 51; $n52 = 52; $n53 = 53; $n54 = 54; $n55 = 55; $n56 = 56; $n57 = 57; $n58 = 58; $n59 = 59; $n60 = 60; $n61 = 61; $n62 = 62; $n63 = 63; $n64 = 64; $n65 = 65; $n66 = 66; $n67 = 67; $n68 = 68; $n69 = 69; $n70 = 70; $n71 = 71; $n72 = 72; $n73 = 73; $n74 = 74; $n75 = 75; $n76 = 76; $n77 = 77; $n78 = 78; $n79 = 79; $n80 = 80; $n81 = 81; $n82 = 82; $n83 = 83; $n84 = 84; $n85 = 85; $n86 = 86; $n87 = 87; $n88 = 88; $n89 = 89; $n90 = 90; $n91 = 91; $n92 = 92;
		$carac = array('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'A', 'b', 'B', 'c', 'C', 'd', 'D', 'e', 'E', 'f', 'F', 'g', 'G', 'h', 'H', 'i', 'I', 'j', 'J', 'k', 'K', 'l', 'L', 'm', 'M', 'n', 'N', 'o', 'O', 'p', 'P', 'q', 'Q', 'r', 'R', 's', 'S', 't', 'T', 'u', 'U', 'v', 'V', 'w', 'W', 'x', 'X', 'y', 'Y', 'z', 'Z', ' ', '@', '[', ']', ',', '_', '.', '&', "'", '"', '#', '{', '}', '(', ')', '/', '=', '+', '*', '?', '!', ':', ';', '<', '>', '%', '&nbsp;');
		$carac3 = array('a', 'A', 'b', 'B', 'c', 'C', 'd', 'D', 'e', 'E', 'f', 'F', 'g', 'G', 'h', 'H', 'i', 'I', 'j', 'J', 'k', 'K', 'l', 'L', 'm', 'M', 'n', 'N', 'o', 'O', 'p', 'P', 'q', 'Q', 'r', 'R', 's', 'S', 't', 'T', 'u', 'U', 'v', 'V', 'w', 'W', 'x', 'X', 'y', 'Y', 'z', 'Z', ' ', '@', '[', ']', ',', '_', '.', '&', "'", '"', '#', '{', '}', '(', ')', '/', '=', '+', '*', '?', '!', ':', ';', '<', '>', '%', '&nbsp;');
		$carac2 = array('0', '1', '2', '3', '4', '5', '6', '7', '8', '9');
		$nb = array($n0.'-', $n1.'-', $n2.'-', $n3.'-', $n4.'-', $n5.'-', $n6.'-', $n7.'-', $n8.'-', $n9.'-', $n10.'-', $n11.'-', $n12.'-', $n13.'-', $n14.'-', $n15.'-', $n16.'-', $n17.'-', $n18.'-', $n19.'-', $n20.'-', $n21.'-', $n22.'-', $n23.'-', $n24.'-', $n25.'-', $n26.'-', $n27.'-', $n28.'-', $n29.'-', $n30.'-', $n31.'-', $n32.'-', $n33.'-', $n34.'-', $n35.'-', $n36.'-', $n37.'-', $n38.'-', $n39.'-', $n40.'-', $n41.'-', $n42.'-', $n43.'-', $n44.'-', $n45.'-', $n46.'-', $n47.'-', $n48.'-', $n49.'-', $n50.'-', $n51.'-', $n52.'-', $n53.'-', $n54.'-', $n55.'-', $n56.'-', $n57.'-', $n58.'-', $n59.'-', $n60.'-', $n61.'-', $n62.'-', $n63.'-', $n64.'-', $n65.'-', $n66.'-', $n67.'-', $n68.'-', $n69.'-', $n70.'-', $n71.'-', $n72.'-', $n73.'-', $n74.'-', $n75.'-', $n76.'-', $n77.'-', $n78.'-', $n79.'-', $n80.'-', $n81.'-', $n82.'-', $n83.'-', $n84.'-', $n85.'-', $n86.'-', $n87.'-', $n88.'-');
		$nb2 = array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9);
		$nb3 = array(10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88);
		$msgTaille = strlen($msgClair);
		$cleTaille = strlen($cle);
		while($cleTaille < $msgTaille){
			$cle .= $cle;
			$cleTaille = strlen($cle);
		}
		$cleModif = str_replace($carac, $nb, $cle);
		$msgModif = str_replace($carac, $nb, $msgClair);
		$cleDecomp = explode('-', $cleModif);
		$msgDecomp = explode('-', $msgModif);
		$msgCrypt = null;
		$code2 = null;
		for($boucle = 0; $boucle < $msgTaille; $boucle++){
			$code = ($msgDecomp[$boucle] + $cleDecomp[$boucle]) % 88;
			//$code2 .= ($msgDecomp[$boucle] + $cleDecomp[$boucle]) % 88;
			if($code == 62)
				$code = 88;
				
			if($code < 10)
				$msgCrypt.= str_replace($nb2, $carac2, $code);
			else
				$msgCrypt.= str_replace($nb3, $carac3, $code);
		}
		
		
		/*echo'message clair : '.$msgClair.'<br/>';
		echo'message modifier : '.$msgModif.'<br/>';
		echo'cle : '.$cle.'<br/>';
		echo'cle modifier : '.$cleModif.'<br/>';
		echo'message taille : '.$msgTaille.'<br/>';
		echo'message crypter modifier  : '.$code2.'<br/>';*/
		
		return $msgCrypt;
	}
	
	function deCryptage($msgCrypt, $cle){
		$n0 = 0; $n1 = 1; $n2 = 2; $n3 = 3; $n4 = 4; $n5 = 5; $n6 = 6; $n7 = 7; $n8 = 8; $n9 = 9; $n10 = 10; $n11 = 11; $n12 = 12; $n13 = 13; $n14 = 14; $n15 = 15; $n16 = 16; $n17 = 17; $n18 = 18; $n19 = 19; $n20 = 20; $n21 = 21; $n22 = 22; $n23 = 23; $n24 = 24; $n25 = 25; $n26 = 26; $n27 = 27; $n28 = 28; $n29 = 29; $n30 = 30; $n31 = 31; $n32 = 32; $n33 = 33; $n34 = 34; $n35 = 35; $n36 = 36; $n37 = 37; $n38 = 38; $n39 = 39; $n40 = 40; $n41 = 41; $n42 = 42; $n43 = 43; $n44 = 44; $n45 = 45; $n46 = 46; $n47 = 47; $n48 = 48; $n49 = 49; $n50 = 50; $n51 = 51; $n52 = 52; $n53 = 53; $n54 = 54; $n55 = 55; $n56 = 56; $n57 = 57; $n58 = 58; $n59 = 59; $n60 = 60; $n61 = 61; $n62 = 62; $n63 = 63; $n64 = 64; $n65 = 65; $n66 = 66; $n67 = 67; $n68 = 68; $n69 = 69; $n70 = 70; $n71 = 71; $n72 = 72; $n73 = 73; $n74 = 74; $n75 = 75; $n76 = 76; $n77 = 77; $n78 = 78; $n79 = 79; $n80 = 80; $n81 = 81; $n82 = 82; $n83 = 83; $n84 = 84; $n85 = 85; $n86 = 86; $n87 = 87; $n88 = 88; $n89 = 89; $n90 = 90; $n91 = 91; $n92 = 92;
		$carac = array('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'A', 'b', 'B', 'c', 'C', 'd', 'D', 'e', 'E', 'f', 'F', 'g', 'G', 'h', 'H', 'i', 'I', 'j', 'J', 'k', 'K', 'l', 'L', 'm', 'M', 'n', 'N', 'o', 'O', 'p', 'P', 'q', 'Q', 'r', 'R', 's', 'S', 't', 'T', 'u', 'U', 'v', 'V', 'w', 'W', 'x', 'X', 'y', 'Y', 'z', 'Z', ' ', '@', '[', ']', ',', '_', '.', '&', "'", '"', '#', '{', '}', '(', ')', '/', '=', '+', '*', '?', '!', ':', ';', '<', '>', '%', '&nbsp;');
		$carac3 = array('a', 'A', 'b', 'B', 'c', 'C', 'd', 'D', 'e', 'E', 'f', 'F', 'g', 'G', 'h', 'H', 'i', 'I', 'j', 'J', 'k', 'K', 'l', 'L', 'm', 'M', 'n', 'N', 'o', 'O', 'p', 'P', 'q', 'Q', 'r', 'R', 's', 'S', 't', 'T', 'u', 'U', 'v', 'V', 'w', 'W', 'x', 'X', 'y', 'Y', 'z', 'Z', ' ', '@', '[', ']', ',', '_', '.', '&', "'", '"', '#', '{', '}', '(', ')', '/', '=', '+', '*', '?', '!', ':', ';', '<', '>', '%', '&nbsp;');
		$carac2 = array('0', '1', '2', '3', '4', '5', '6', '7', '8', '9');
		$nb = array($n0.'-', $n1.'-', $n2.'-', $n3.'-', $n4.'-', $n5.'-', $n6.'-', $n7.'-', $n8.'-', $n9.'-', $n10.'-', $n11.'-', $n12.'-', $n13.'-', $n14.'-', $n15.'-', $n16.'-', $n17.'-', $n18.'-', $n19.'-', $n20.'-', $n21.'-', $n22.'-', $n23.'-', $n24.'-', $n25.'-', $n26.'-', $n27.'-', $n28.'-', $n29.'-', $n30.'-', $n31.'-', $n32.'-', $n33.'-', $n34.'-', $n35.'-', $n36.'-', $n37.'-', $n38.'-', $n39.'-', $n40.'-', $n41.'-', $n42.'-', $n43.'-', $n44.'-', $n45.'-', $n46.'-', $n47.'-', $n48.'-', $n49.'-', $n50.'-', $n51.'-', $n52.'-', $n53.'-', $n54.'-', $n55.'-', $n56.'-', $n57.'-', $n58.'-', $n59.'-', $n60.'-', $n61.'-', $n62.'-', $n63.'-', $n64.'-', $n65.'-', $n66.'-', $n67.'-', $n68.'-', $n69.'-', $n70.'-', $n71.'-', $n72.'-', $n73.'-', $n74.'-', $n75.'-', $n76.'-', $n77.'-', $n78.'-', $n79.'-', $n80.'-', $n81.'-', $n82.'-', $n83.'-', $n84.'-', $n85.'-', $n86.'-', $n87.'-', $n88.'-');
		$nb2 = array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9);
		$nb3 = array(10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88);
		$msgCrypt = str_replace('&nbsp;', ' ', $msgCrypt);
		$msgTaille = strlen($msgCrypt);
		$cleTaille = strlen($cle);
		while($cleTaille < $msgTaille){
			$cle .= $cle;
			$cleTaille = strlen($cle);
		}
		$cleModif = str_replace($carac, $nb, $cle);
		$msgModif = str_replace($carac, $nb, $msgCrypt);
		$cleDecomp = explode('-', $cleModif);
		$msgDecomp = explode('-', $msgModif);
		$msgClair = null;
		$code2 = null;
		for($boucle = 0; $boucle < $msgTaille; $boucle++){
			if($cleDecomp[$boucle] > $msgDecomp[$boucle]){
				$code = (88 - $cleDecomp[$boucle]) + $msgDecomp[$boucle];
				//$code2 .= (88 - $cleDecomp[$boucle]) + $msgDecomp[$boucle];
			}
			else{
				$code = $msgDecomp[$boucle] - $cleDecomp[$boucle];
				//$code2 .= $msgDecomp[$boucle] - $cleDecomp[$boucle];
			}
			
			if($code < 10)
				$msgClair.= str_replace($nb2, $carac2, $code);
			else
				$msgClair.= str_replace($nb3, $carac3, $code);
		}
		
		/*echo'message crypter : '.$msgCrypt.'<br/>';
		echo'message modifier : '.$msgModif.'<br/>';
		echo'cle : '.$cle.'<br/>';
		echo'cle modifier : '.$cleModif.'<br/>';
		echo'message taille : '.$msgTaille.'<br/>';
		echo'message clair modifier  : '.$code2.'<br/>';*/
		
		return $msgClair;
	}
	
	/*$clef = 'merde';
	$msg = cryptage("eeeee", $clef);
	echo'<br/>-----------Teste de ma fonction de cryptage en vigen√®re-----------------<br/><br/>';
	echo 'message crypter : '.cryptage("eeeee", $clef).'<br/>';
	echo'<br/>====================================================<br/><br/>';
	echo 'message clair : '.deCryptage($msg, $clef);*/
?>
